# Smart Speaker System (audio_play_LED)
    ç°¡æ˜“çš„å•†å ´éŸ³è¨Šå»£æ’­èˆ‡ LED æ§åˆ¶ç³»çµ±ã€‚ä½¿ç”¨è€…å¯é€éç¶²é ä¸Šå‚³éŸ³è¨Šæª”ï¼Œä¼ºæœå™¨å°‡æª”æ¡ˆè½‰æ›å¾Œå‚³é€çµ¦ Raspberry Pi 5 éŸ³è¨Šæ¨¡çµ„æ’­æ”¾ï¼ŒåŒæ™‚å¯é€éæŒ‰éˆ•åˆ‡æ› LED é¡¯ç¤ºæ¨¡å¼ã€‚

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```bash
audio_play_LED/
â”œâ”€â”€ README.md               # æœ¬èªªæ˜æ–‡ä»¶
â”œâ”€â”€ server.js               # Node.js Express TCP å‚³é€å™¨ + LED æ§åˆ¶ä¼ºæœå™¨
â”œâ”€â”€ wav.py                  # Python å·¥å…·ï¼šå°‡ä¸­æ–‡è½‰ç‚º mp3 ä¸¦è½‰æ›ç‚º wav
â”œâ”€â”€ audio_sample.h          # Raspberry Pi 5 éŸŒé«”ä¸­çš„éŸ³è¨Šè³‡æ–™ï¼ˆè½‰æˆ byte é™£åˆ—ï¼‰
â”œâ”€â”€ I2S.ino                 # Raspberry Pi 5 ä¸»ç¨‹å¼ï¼Œæ¥æ”¶éŸ³è¨Šä¸¦é€é I2S æ’­æ”¾
â”‚
â”œâ”€â”€ audio/                  # éŸ³è¨Šç›¸é—œç›®éŒ„
â”‚   â”œâ”€â”€ uploads/            # ä¸Šå‚³çš„åŸå§‹éŸ³æª” (è‡ªå‹•æ¸…é™¤)
â”‚   â””â”€â”€ converted/          # ç¶“ ffmpeg è½‰ç‚º 24000Hz wav çš„éŸ³è¨Š (è‡ªå‹•æ¸…é™¤)
â”‚
â”œâ”€â”€ public/                 # å‰ç«¯é é¢
â”‚   â””â”€â”€ index.html          # ç¶²é æ“ä½œä»‹é¢ï¼ˆä¸Šå‚³éŸ³è¨Šã€åˆ‡æ› LED æ¨¡å¼ï¼‰
â”‚
â”œâ”€â”€ kernel_driver/          # Linux æ ¸å¿ƒæ¨¡çµ„ï¼ˆé©…å‹• WS2812ï¼‰
â”‚   â”œâ”€â”€ meme-ws2812.c       # âœ… SPI ä»‹é¢çš„ WS2812 é©…å‹•åŸå§‹ç¢¼ï¼ˆç”±ä½¿ç”¨è€…è£œå®Œç‰ˆæœ¬ï¼‰
â”‚   â”œâ”€â”€ meme-ws2812.dts     # Device tree sourceï¼Œå®šç¾© compatible = "meme,ws2812"
â”‚   â”œâ”€â”€ meme-ws2812.mod.c   # ç·¨è­¯è‡ªå‹•ç”¢ç”Ÿæ¨¡çµ„æè¿°æª”ï¼ˆéåŸå§‹ç¢¼ï¼‰
â”‚   â”œâ”€â”€ Makefile            # ç·¨è­¯é©…å‹•æ¨¡çµ„çš„è…³æœ¬
â”‚
â”œâ”€â”€ play.c                  # ä½¿ç”¨è€…ç©ºé–“ç¨‹å¼ï¼šè®€å– ws2812_mode.txt æ§åˆ¶ LED æ¨¡å¼
â”œâ”€â”€ ws2812_mode.txt         # æš«å­˜ LED æ¨¡å¼ï¼ˆ0~3ï¼‰
```

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### Node.js å¾Œç«¯

1. å®‰è£ä¾è³´ï¼š
```bash
npm install express multer net
```

2. éœ€å®‰è£ ffmpegï¼š
```bash
sudo apt install ffmpeg
```

3. å•Ÿå‹•ä¼ºæœå™¨ï¼š
```bash
node server.js
```

### å‰ç«¯é é¢

é€éç€è¦½å™¨é–‹å•Ÿ `http://localhost:3000`ï¼Œå³å¯ä¸Šå‚³éŸ³è¨Šæˆ–åˆ‡æ› LED æ¨¡å¼ã€‚

### Raspberry Pi 5 éŸŒé«”

è«‹ä½¿ç”¨ Arduino IDE ä¸Šå‚³ `I2S.ino` è‡³ Raspberry Pi 5ï¼Œä¸¦æ¥å¥½ MAX98357A I2S æ¨¡çµ„èˆ‡æ—‹éˆ•ï¼š
- éŸ³è¨Šè…³ä½ï¼šDOUT=19, BCLK=20, WS=21, MCLK=22
- éŸ³é‡æ—‹éˆ•ï¼šGPIO26 (ADC0)

### LED æ ¸å¿ƒæ¨¡çµ„

1. é€²å…¥ kernel_driver è³‡æ–™å¤¾
```bash
cd audio_play_LED/kernel_driver
make
sudo insmod meme-ws2812.ko
```

2. åŸ·è¡Œ LED æ¨¡å¼æ§åˆ¶ç¨‹å¼ï¼š
```bash
gcc ../play.c -o play
sudo ./play
```

### æ–‡å­—è½‰éŸ³è¨Šå·¥å…·

å°‡ä¸­æ–‡æ–‡å­—è½‰ç‚ºèªéŸ³ wav æª”ï¼š
```bash
python3 wav.py
```
æœƒç”¢ç”Ÿ `ad2.wav` å¯ä¾›ä¸Šå‚³ã€‚

## ğŸ¯ ç‰¹è‰²

- é€é TCP socket å‚³é€éŸ³è¨Šè³‡æ–™è‡³ Raspberry Pi 5ï¼Œä¸¦ç«‹å³æ’­æ”¾
- Node.js ä¼ºæœå™¨è‡ªå‹•è½‰æª”ï¼ˆmp3 â†’ wav â†’ byte arrayï¼‰
- Raspberry Pi 5 éŸ³è¨Šæ’­æ”¾æ”¯æ´éŸ³é‡æ—‹éˆ•æ§åˆ¶
- è‡ªè£½ SPI WS2812 Linux driverï¼Œæ­é…ä½¿ç”¨è€…ç©ºé–“æ§åˆ¶ç¨‹å¼ `play.c`

## ğŸ“Œ æ³¨æ„äº‹é …

- å‚³é€è‡³ Raspberry Pi 5 çš„éŸ³è¨Šéœ€ç‚º 24000Hz, mono, 16-bit PCM æ ¼å¼
- æ¯æ¬¡æ’­æ”¾åƒ…æ”¯æ´ä¸€ç­†è³‡æ–™ï¼Œè‹¥éœ€é€£çºŒæ’­æ”¾å¯å»¶ä¼¸ buffer queue
- WS2812 é©…å‹•æ¡ SPI å‚³è¼¸æ–¹å¼ï¼Œè«‹ç¢ºèªç¡¬é«”æ¥è…³ç¬¦åˆ device tree è¨­å®š
